<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>CTF Final</title>
    <style>
      body {
        text-align: center;
        font-family: Arial, sans-serif;
        margin-top: 50px;
      }
    </style>
  </head>
  <body>
    <h1>Congrats!!</h1>
    <p>You made it to the final stage. But where is the flag? I wonder where to inspect?</p>
    <!-- flag3{hog_malko} -->

    <canvas id="confetti" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;"></canvas>
    
    <script>
      const canvas = document.getElementById('confetti');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      class ConfettiPiece {
        constructor() {
          this.x = Math.random() * canvas.width;
          this.y = Math.random() * -canvas.height; // start above screen
          this.w = 10;
          this.h = 20;
          this.color = `hsl(${Math.random() * 360}, 100%, 50%)`;
          this.speedY = Math.random() * 3 + 2;
          this.rotation = Math.random() * 360;
          this.rotationSpeed = (Math.random() - 0.5) * 10;
          this.drift = Math.random() * 2 + 1; // horizontal sway
          this.offset = Math.random() * 100; // phase shift for variety
        }

        update(frame) {
          this.y += this.speedY;
          this.x += Math.sin((frame + this.offset) / 30) * this.drift;
          this.rotation += this.rotationSpeed;
        }

        draw(ctx) {
          ctx.save();
          ctx.translate(this.x, this.y);
          ctx.rotate(this.rotation * Math.PI / 180);
          ctx.fillStyle = this.color;
          ctx.fillRect(-this.w / 2, -this.h / 2, this.w, this.h);
          ctx.restore();
        }

        isOffScreen() {
          return this.y > canvas.height + 50;
        }
      }

      const confettiPieces = Array.from({ length: 150 }, () => new ConfettiPiece());
      let frame = 0;

      function animate() {
        frame++;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        let allOffScreen = true;
        confettiPieces.forEach(p => {
          if (!p.isOffScreen()) {
            allOffScreen = false;
            p.update(frame);
            p.draw(ctx);
          }
        });

        if (!allOffScreen) {
          requestAnimationFrame(animate);
        } else {
          ctx.clearRect(0, 0, canvas.width, canvas.height); // final clean
        }
      }

      animate();
    </script>
  </body>
</html>
